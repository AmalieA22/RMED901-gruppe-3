---
title: "RMED901 Group 3 report"
Authors: "Amalie Austgulen, André Høberg, Ariell Thale Toftesund Longva, Ghazal Lessan Toussi"
output: html_document
date: "2022-09-15"
---
This is the report for group 3 in RMED901.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Reading and loading the data**  

We load the necessary packages first.
```{r}
library(tidyverse)
library(here)
```

We read the non tidy version of the data, that we will try to tidy later.
```{r}
data_nontidy <- read_delim(here("data", "copy_exam_nontidy.txt"))
```

**Exploring the data**  

Before tidying, we wished to explore the data. We did this by using functions such as head, tail, summary and glimpse.  
Here we only show the results of summary and glimpse, since these gave us the most information about the dataset.
```{r, echo = FALSE}
head(data_nontidy)
tail(data_nontidy)
```

```{r}
summary(data_nontidy)
```
```{r}
glimpse(data_nontidy)
```
```{r}
skimr::skim(data_nontidy)
```

There are 15 columns and 34 048 rows in this dataset. 

When looking at the data, we noticed multiple aspects that we wished to change later, such as:  

- Time.measurement should be two variables: col_rec_that and rec_ver_tat
- Gender.age was one column, when it should be two  
- Age, pan_day, drive_thru_ind and ct_result were all of the type character, when they should be numeric.  

We also noticed that there are 12 344 unique values for subject, which may indicate that there are variables that lead to multiple observations.  

In the skim, we saw that there is 15527 missing values for the column payor_group, 15506 for patient_class and 452 for ct_result. This we explored further with the use of gg_miss_var.

```{r}
naniar::gg_miss_var(data_nontidy)
```

**Exploring the missing data**
After exploring the data in data_wrangled, we wished to look at the missing data. To do this, we first used the gg_miss_var function.
```{r}
naniar::gg_miss_var(data_wrangled)
```
This returns more than 8000 missing values for the columns payor_group and patient_class, and <500 for ct_result.  

To get more specific numbers for missing values, we wanted to count up the NAs in each column. To do this, we first filtered by NAs, and afterwards counted the remaining values.
```{r}
#For payor_group
data_wrangled %>%
  filter(is.na(payor_group))%>%
    count(payor_group)
```
```{r}
#For patient class
data_wrangled %>%  
  filter(is.na(patient_class))%>%
    count(patient_class)
```
```{r}
#For ct_result
data_wrangled %>%
  filter(is.na(ct_result))%>%
    count(ct_result)
```
In the output, we see that payor_group returns 7087 NA, patient_class returns 7077 NA and ct_result returns 209 NA. When compared to the untidy data, the number of missing values have decreased substantially.  

When looking at the values in the dataset, it seems like the patients who tested for covid-19 in clinical labs did not have any data on payor group or patient class.  
To test if this hypothesis was true, we first filtered out by those who were tested in a clinical lab or "line clinical lab", and then those who had missing values in either patient_class or payor_group. 
```{r}
#Missing payor group values in patients who were tested in a clinical lab
data_wrangled %>%
  filter(clinic_name == "clinical lab") %>%
    filter(is.na(payor_group)) %>%
      count(payor_group)

data_wrangled %>%
  filter(clinic_name == "line clinical lab-") %>%
    filter(is.na(payor_group)) %>%
      count(payor_group)
```
```{r}
#Missing patient class values in patients who were tested in a clinical lab
data_wrangled %>%
  filter(clinic_name == "clinical lab") %>%
    filter(is.na(patient_class)) %>%
      count(patient_class)

data_wrangled %>%
  filter(clinic_name == "line clinical lab-") %>%
  filter(is.na(patient_class)) %>%
  count(patient_class)
```
For those tested in a clinical lab, there are 6407 missing values for payor_group and 6406 for patient_class. For the line clinical lab, there are 218 missing values for payor_group and 218 for patient_class.  
The majority of the missing values are therefore connected to the fact that some are tested in a clinical lab.









